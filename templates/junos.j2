{% set vlansall = [] %}
{% set dev = nb_device.json.results[0] %}
{% set sys = nb_device.json.results[0].config_context.system %}
set system host-name {{ dev.name }}
{% for ntp in sys.ntp %}
set system ntp server {{ sys.ntp[ntp] }}
{% endfor %}
{% for login in sys.login.user %}
set system login user {{ sys.login.user[login]['name'] }} class {{ sys.login.user[login]['class'] }}
set system login user {{ sys.login.user[login]['name'] }} authentication encrypted-password "{{ sys.login.user[login]['password'] }}"
{% endfor %}
{% for intf in nb_interfaces.json.results %}
  {% if  intf.type.value == "1000base-t" %}
    {% if intf.description|length %}
  set interfaces {{ intf.name }} description {{ intf.description }}
      {% for vlans in intf.tagged_vlans %}
  set interfaces {{ intf.name }} unit 0 family ethernet-switching vlan members {{ vlans.vid }}
        {% if vlansall.append( vlans.vid|string+":"+vlans.name ) %} {% endif %}
      {% endfor %}
    {%endif %}
  {% elif "vlan" in intf.name %}
    {% set unit = intf.name.split('.') %}
set interfaces vlan unit {{ unit[1] }} family inet address 69.69.69.69/20\
      {% for ips in nb_ips.json.results %}
        {% if ips.interface.id == intf.id %}
set interfaces vlan unit {{ unit[1] }} family inet address {{ ips.address }}
        {% endif %}
      {% endfor %}
    {% if intf.description|length %}
set interfaces vlan unit {{ unit[1] }} description {{ intf.description }}
    {% endif %}
  {%elif "lo0" in intf.name %}
    {% for ips in nb_ips.json.results %}
      {% if ips.interface.id == intf.id %}
set interfaces lo0 unit 0 family inet address {{ ips.address }}
      {% endif %}
    {% endfor %}
    {% if intf.description|length %}
set interfaces lo0 unit 0 {{ intf.description }}
    {% endif %}
  {%endif %}
{% endfor %}
{% for vlans_add in vlansall|unique %}
    {% set vid, vname = vlans_add.split(':') %}
set vlans {{ vname }} vlan-id {{ vid }}
{% endfor %}
